@*@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formSpouseLanguage" }))
    {*@
<!--@Html.AntiForgeryToken()

<div class="form-horizontal">-->
@*@Html.ValidationSummary(false, "", new { @class = "text-danger" })*@
<!--<div class="card shadow p-3 mt-4">
            <div class="card-header" style="background-color:#fff">
                LANGUAGES KNOWN
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-md-7">
                        <label class="control-label">Language</label>
                        <input type="text" name="laSLanguage" id="laSLanguage_1" required title="Enter Language" class="form-control" placeholder="Language">
                    </div>
                    <div class="form-group col-md-1">
                        <label class="control-label pb-4" style="width:100%"></label>
                        <label>
                            Read
                            <input type="checkbox" name="laSRead" id="laSRead_1" class="custom-checkbox">
                        </label>
                    </div>
                    <div class="form-group col-md-1">
                        <label class="control-label pb-4" style="width:100%"></label>
                        <label>
                            Write
                            <input type="checkbox" name="laSWrite" id="laSWrite_1" class="custom-checkbox">
                        </label>
                    </div>
                    <div class="form-group col-md-1">
                        <label class="control-label pb-4" style="width:100%"></label>
                        <label>
                            Speak
                            <input type="checkbox" name="laSSpeak" id="laSSpeak_1" class="custom-checkbox">
                        </label>
                    </div>
                    <div class="form-group col-md-2">
                        <label class="control-label pb-3" style="width:100%"></label>
                        <button type="button" class="add-SpouseLanguage btn btn-outline-primary btn-sm"><i class="fa fa-plus"></i></button>
                        <button type="button" class="remove-SpouseLanguage btn btn-outline-danger ml-2 btn-sm"><i class="fa fa-minus"></i></button>
                    </div>
                </div>
                <div id="new_laS"></div>
                <input type="hidden" value="1" id="total_laS">

                <div class="form-group mt-4 text-center">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="button" value="Submit" onclick="addSpouseLanguages()" class="btn btn-primary" />
                    </div>
                </div>
            </div>
        </div>
    </div>
}-->
@*<script>
        // #region Language
        function storeSpouseLanguage() {
            let ttlla = $('#total_laS').val();
            let languages = [];
            for (i = 1, j = 0; i <= ttlla; i++ , j++) {
                languages[j] = {
                    Language: $('#laSLanguage_' + i).val(),
                    Read: document.getElementById('laSRead_' + i).checked,
                    Write: document.getElementById('laSWrite_' + i).checked,
                    Speak: document.getElementById('laSSpeak_' + i).checked,
                    SpouseId: $('#hdnSpouseId').val(),
                };
            }
            return languages;
        }

        $('.add-SpouseLanguage').on('click', addSpouseLanguage);
        $('.remove-SpouseLanguage').on('click', removeSpouseLanguage);
        function addSpouseLanguage() {
            let new_la_no = parseInt($('#total_laS').val()) + 1;
            let new_inputLa = `<div id="Language_${new_la_no}" class="form-row">
                               <div class="form-group col-md-7">
                                   <input type="text" name="laSLanguage" id="laSLanguage_${new_la_no}" required title="Enter Language Known" class="form-control" placeholder="Language">
                               </div>
                               <div class="form-group col-md-1">
                                   <label>Read
                                   <input type="checkbox" name="laSRead" id="laSRead_${new_la_no}" class="custom-checkbox"></label>
                               </div>
                               <div class="form-group col-md-1">
                                   <label>Write
                                   <input type="checkbox" name="laSWrite" id="laSWrite_${new_la_no}" class="custom-checkbox"></label>
                               </div>
                               <div class="form-group col-md-1">
                                   <label>Speak
                                   <input type="checkbox" name="laSSpeak" id="laSSpeak_${new_la_no}" class="custom-checkbox"></label>
                               </div>
                           </div>`;
            $('#new_laS').append(new_inputLa);
            $('#total_laS').val(new_la_no);

            // Add validation rule for the new input
            $("#laSLanguage_" + new_la_no).rules("add", { required: true });
        }

        function removeSpouseLanguage() {
            let last_la_no = $('#total_laS').val();

            if (last_la_no > 1) {
                $('#Language_' + last_la_no).remove();
                $('#total_laS').val(last_la_no - 1);
            }
        }
        // #endregion

        function addSpouseLanguages() {
            if ($("#formSpouseLanguage").valid()) {
                let languageList = storeSpouseLanguage();
                let languages = JSON.stringify(languageList);

                $.ajax({
                    type: 'post',
                    url: '/api/courseMembers/SpouseLanguage',
                    data: languages,
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    success: function (data, textStatus, xhr) {
                        toastr.success('Languages saved successfully!');
                        displayTab('SpousePartial');
                    },
                    error: function () {
                        toastr.error('Operation Failed!');
                    }
                });
            }
        }

    </script>

    <script>
        $(document).ready(function () {
            $("#formSpouseLanguage").validate({
                errorClass: "text-danger",
                rules: {
                    laSLanguage: { required: true }
                },
                messages: {
                    laSLanguage: "Enter Language"
                }
            });
        });

    </script>*@

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formSpouseLanguage" }))
{
    @Html.AntiForgeryToken()

    <div class="card shadow p-3 mt-4">
        <div class="card-header bg-white">
            LANGUAGES KNOWN
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped" id="tblSpouseLanguage">
                <thead class="table-light">
                    <tr>
                        <th>Language</th>
                        <th class="text-center">Read</th>
                        <th class="text-center">Write</th>
                        <th class="text-center">Speak</th>
                        <th style="width:120px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="Language_1">
                        <td><input type="text" name="laSLanguage" id="laSLanguage_1" class="form-control" required placeholder="Language"></td>
                        <td class="text-center"><input type="checkbox" name="laSRead" id="laSRead_1" class="custom-checkbox"></td>
                        <td class="text-center"><input type="checkbox" name="laSWrite" id="laSWrite_1" class="custom-checkbox"></td>
                        <td class="text-center"><input type="checkbox" name="laSSpeak" id="laSSpeak_1" class="custom-checkbox"></td>
                        <td class="text-center">
                            <button type="button" class="add-SpouseLanguage btn btn-outline-primary btn-sm me-1"><i class="fa fa-plus"></i></button>
                            <button type="button" class="remove-SpouseLanguage btn btn-outline-danger btn-sm"><i class="fa fa-minus"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <input type="hidden" id="total_laS" value="1" />

            <div class="text-center mt-4">
                <input type="button" value="Submit" onclick="addSpouseLanguages()" class="btn btn-outline-danger">
            </div>
        </div>
    </div>
}

<script>
    function storeSpouseLanguage() {
        let ttlla = $('#total_laS').val();
        let languages = [];
        for (let i = 1; i <= ttlla; i++) {
            languages.push({
                Language: $('#laSLanguage_' + i).val(),
                Read: $('#laSRead_' + i).is(':checked'),
                Write: $('#laSWrite_' + i).is(':checked'),
                Speak: $('#laSSpeak_' + i).is(':checked'),
                SpouseId: $('#hdnSpouseId').val()
            });
        }
        return languages;
    }

    function updateLanguageButtons() {
        $('#tblSpouseLanguage tbody tr').each(function () {
            $(this).find('.add-SpouseLanguage').hide();
            $(this).find('.remove-SpouseLanguage').show();
        });
        let lastRow = $('#tblSpouseLanguage tbody tr:last');
        lastRow.find('.add-SpouseLanguage').show();
        if ($('#tblSpouseLanguage tbody tr').length === 1) {
            lastRow.find('.remove-SpouseLanguage').show();
        }
    }

    function addSpouseLanguage() {
        let new_la_no = parseInt($('#total_laS').val()) + 1;
        let new_row = `<tr id="Language_${new_la_no}">
            <td><input type="text" name="laSLanguage" id="laSLanguage_${new_la_no}" class="form-control" required placeholder="Language"></td>
            <td class="text-center"><input type="checkbox" name="laSRead" id="laSRead_${new_la_no}" class="custom-checkbox"></td>
            <td class="text-center"><input type="checkbox" name="laSWrite" id="laSWrite_${new_la_no}" class="custom-checkbox"></td>
            <td class="text-center"><input type="checkbox" name="laSSpeak" id="laSSpeak_${new_la_no}" class="custom-checkbox"></td>
            <td class="text-center">
                <button type="button" class="add-SpouseLanguage btn btn-outline-primary btn-sm me-1"><i class="fa fa-plus"></i></button>
                <button type="button" class="remove-SpouseLanguage btn btn-outline-danger btn-sm"><i class="fa fa-minus"></i></button>
            </td>
        </tr>`;
        $('#tblSpouseLanguage tbody').append(new_row);
        $('#total_laS').val(new_la_no);

        updateLanguageButtons();
    }

    function removeSpouseLanguage() {
        if ($('#tblSpouseLanguage tbody tr').length > 1) {
            $(this).closest('tr').remove();
            let lastRowId = $('#tblSpouseLanguage tbody tr:last').attr('id');
            $('#total_laS').val(lastRowId.split('_')[1]);
            updateLanguageButtons();
        }
    }

    $(document).on('click', '.add-SpouseLanguage', addSpouseLanguage);
    $(document).on('click', '.remove-SpouseLanguage', removeSpouseLanguage);

    function addSpouseLanguages() {
        if ($("#formSpouseLanguage").valid()) {
            let languageList = storeSpouseLanguage();
            $.ajax({
                type: 'POST',
                url: '/api/courseMembers/SpouseLanguage',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(languageList),
                success: function () {
                    toastr.success('Languages saved successfully!');
                    displayTab('SpousePartial');
                },
                error: function () {
                    toastr.error('Operation Failed!');
                }
            });
        }
    }

    $(document).ready(function () {
        $("#formSpouseLanguage").validate({
            errorClass: "text-danger",
            rules: { laSLanguage: { required: true } },
            messages: { laSLanguage: "Enter Language" }
        });
        updateLanguageButtons();
    });
</script>

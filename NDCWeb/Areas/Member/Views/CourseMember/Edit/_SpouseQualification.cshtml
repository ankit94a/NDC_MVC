@*@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formSpouseQualification" }))
    {
        @Html.AntiForgeryToken()*@

<!--<div class="form-horizontal">-->
@*@Html.ValidationSummary(false, "", new { @class = "text-danger" })*@
<!--<div class="card shadow p-3 mt-4">
            <div class="card-header" style="background-color:#fff">
                PROFESSIONAL QUALIFICATIONS
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-md-3">
                        <input type="text" name="quSProfessionalEdu" id="quSProfessionalEdu_1" required title="Enter Professional Qualification" class="form-control" placeholder="Professional Qualification">
                    </div>
                    <div class="form-group col-md-2">
                        <input type="text" name="quSAcademicAchievement" id="quSAcademicAchievement_1" required title="Enter Academic Achievement" class="form-control" placeholder="Academic Achievement">
                    </div>
                    <div class="form-group col-md-2">
                        <input type="text" name="quSDivision" id="quSDivision_1" required title="Grade/Division" class="form-control" placeholder="Grade/Division">
                    </div>
                    <div class="form-group col-md-3">
                        <input type="text" name="quSInstitute" id="quSInstitute_1" required title="Enter Institute" class="form-control" placeholder="Institute">
                    </div>

                    <div class="form-group col-md-2">
                        <button type="button" class="add-SpouseQualification btn btn-outline-primary btn-sm"><i class="fa fa-plus"></i></button>
                        <button type="button" class="remove-SpouseQualification btn btn-outline-danger ml-2 btn-sm"><i class="fa fa-minus"></i> </button>
                    </div>
                </div>
            </div>
            <div id="new_quS"></div>
            <input type="hidden" value="1" id="total_quS">

            <div class="form-group mt-4 text-center">
                <div class="">
                    <input type="button" value="Submit" onclick="addSpouseQualifications()" class="btn btn-outline-danger" />
                </div>
            </div>
        </div>
    </div>
}-->
@*<script>
        // #region Qualification
        function storeSpouseQualification() {
            let ttlrows = $('#total_quS').val();
            let qualifications = [];
            for (i = 1, j = 0; i <= ttlrows; i++ , j++) {
                qualifications[j] = {
                    ProfessionalEdu: $('#quSProfessionalEdu_' + i).val(),
                    AcademicAchievement: $('#quSAcademicAchievement_' + i).val(),
                    Division: $('#quSDivision_' + i).val(),
                    Institute: $('#quSInstitute_' + i).val(),
                    SpouseId: $('#hdnSpouseId').val(),
                };
            }
            return qualifications;
        }
        $('.add-SpouseQualification').on('click', addSpouseQualification);
        $('.remove-SpouseQualification').on('click', removeQualification);
        function addSpouseQualification() {
            let new_row_no = parseInt($('#total_quS').val()) + 1;
            let new_row_inputs = `<div id="SpouseQualification_${new_row_no}" class="form-row">
                               <div class="form-group col-md-3">
                                   <input type="text" name="quSProfessionalEdu" id="quSProfessionalEdu_${new_row_no}" required title="Enter Professional Qualification" class="form-control" placeholder="Professional Qualification">
                               </div>
                               <div class="form-group col-md-2">
                                   <input type="text" name="quSAcademicAchievement" id="quSAcademicAchievement_${new_row_no}" required title="Enter Academic Achievement" class="form-control" placeholder="Academic Achievement">
                               </div>
                               <div class="form-group col-md-2">
                                   <input type="text" name="quSDivision" id="quSDivision_${new_row_no}" required title="Grade/Division" class="form-control" placeholder="Grade/Division">
                               </div>
                               <div class="form-group col-md-3">
                                   <input type="text" name="quSInstitute" id="quSInstitute_${new_row_no}" required title="Enter Institute" class="form-control" placeholder="Institute">
                               </div>
                           </div>`;
            $('#new_quS').append(new_row_inputs);
            $('#total_quS').val(new_row_no);

            // Add validation rules to the new inputs
            $("#quSProfessionalEdu_" + new_row_no).rules("add", { required: true });
            $("#quSAcademicAchievement_" + new_row_no).rules("add", { required: true });
            $("#quSDivision_" + new_row_no).rules("add", { required: true });
            $("#quSInstitute_" + new_row_no).rules("add", { required: true });
        }

        function removeQualification() {
            let last_row_no = $('#total_quS').val();
            if (last_row_no > 1) {
                $('#SpouseQualification_' + last_row_no).remove();
                $('#total_quS').val(last_row_no - 1);
            }
        }
        // #endregion

        function addSpouseQualifications() {
            let form = $("#formSpouseQualification");

            // Ensure the validator is initialized

            if (!form.data('validator')) {
                form.validate();
            }


            // if (form.valid()) {

            if ($("#formSpouseQualification").valid()) {
                let qualificationList = storeSpouseQualification();
                let qualifications = JSON.stringify(qualificationList);

                $.ajax({
                    type: 'post',
                    url: '/api/courseMembers/SpouseQualification',
                    data: qualifications,
                    contentType: "application/json; charset=utf-8",
                    datatype: 'json',
                    success: function (data, textStatus, xhr) {
                        toastr.success('Qualifications saved successfully!');
                        displayTab('SpousePartial');
                    },
                    error: function () {
                        toastr.error('Operation Failed!');
                    }
                });
            }
        }

    </script>

    <script>
        $(document).ready(function () {
            $("#formSpouseQualification").validate({
                errorClass: "text-danger",
                rules: {
                    quSProfessionalEdu: { required: true },
                    quSAcademicAchievement: { required: true },
                    quSDivision: { required: true },
                    quSInstitute: { required: true }
                },
                messages: {
                    quSProfessionalEdu: "Enter Professional Qualification",
                    quSAcademicAchievement: "Enter Academic Achievement",
                    quSDivision: "Enter Grade/Division",
                    quSInstitute: "Enter Institute"
                }
            });
        });

    </script>*@

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formSpouseQualification" }))
{
    @Html.AntiForgeryToken()

    <div class="card shadow p-3 mt-4">
        <div class="card-header bg-white">
            PROFESSIONAL QUALIFICATIONS
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped" id="tblSpouseQualification">
                <thead class="table-light">
                    <tr>
                        <th>Professional Qualification</th>
                        <th>Academic Achievement</th>
                        <th>Grade/Division</th>
                        <th>Institute</th>
                        <th style="width:120px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="SpouseQualification_1">
                        <td><input type="text" name="quSProfessionalEdu" id="quSProfessionalEdu_1" class="form-control" required placeholder="Professional Qualification"></td>
                        <td><input type="text" name="quSAcademicAchievement" id="quSAcademicAchievement_1" class="form-control" required placeholder="Academic Achievement"></td>
                        <td><input type="text" name="quSDivision" id="quSDivision_1" class="form-control" required placeholder="Grade/Division"></td>
                        <td><input type="text" name="quSInstitute" id="quSInstitute_1" class="form-control" required placeholder="Institute"></td>
                        <td class="text-center">
                            <button type="button" class="add-SpouseQualification btn btn-outline-primary btn-sm me-1"><i class="fa fa-plus"></i></button>
                            <button type="button" class="remove-SpouseQualification btn btn-outline-danger btn-sm"><i class="fa fa-minus"></i></button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <input type="hidden" id="total_quS" value="1" />

            <div class="text-center mt-4">
                <input type="button" value="Submit" onclick="addSpouseQualifications()" class="btn btn-outline-danger">
            </div>
        </div>
    </div>
}

<script>
    // #region Professional Qualification Table
    function storeSpouseQualification() {
        let total = $('#total_quS').val();
        let qualifications = [];
        for (let i = 1; i <= total; i++) {
            qualifications.push({
                ProfessionalEdu: $('#quSProfessionalEdu_' + i).val(),
                AcademicAchievement: $('#quSAcademicAchievement_' + i).val(),
                Division: $('#quSDivision_' + i).val(),
                Institute: $('#quSInstitute_' + i).val(),
                SpouseId: $('#hdnSpouseId').val()
            });
        }
        return qualifications;
    }

    function updateQualificationButtons() {
        $('#tblSpouseQualification tbody tr').each(function () {
            $(this).find('.add-SpouseQualification').hide();
            $(this).find('.remove-SpouseQualification').show();
        });
        let lastRow = $('#tblSpouseQualification tbody tr:last');
        lastRow.find('.add-SpouseQualification').show();
        if ($('#tblSpouseQualification tbody tr').length === 1) {
            lastRow.find('.remove-SpouseQualification').show();
        }
    }

    function addSpouseQualification() {
        let new_no = parseInt($('#total_quS').val()) + 1;
        let new_row = `<tr id="SpouseQualification_${new_no}">
            <td><input type="text" name="quSProfessionalEdu" id="quSProfessionalEdu_${new_no}" class="form-control" required placeholder="Professional Qualification"></td>
            <td><input type="text" name="quSAcademicAchievement" id="quSAcademicAchievement_${new_no}" class="form-control" required placeholder="Academic Achievement"></td>
            <td><input type="text" name="quSDivision" id="quSDivision_${new_no}" class="form-control" required placeholder="Grade/Division"></td>
            <td><input type="text" name="quSInstitute" id="quSInstitute_${new_no}" class="form-control" required placeholder="Institute"></td>
            <td class="text-center">
                <button type="button" class="add-SpouseQualification btn btn-outline-primary btn-sm me-1"><i class="fa fa-plus"></i></button>
                <button type="button" class="remove-SpouseQualification btn btn-outline-danger btn-sm"><i class="fa fa-minus"></i></button>
            </td>
        </tr>`;
        $('#tblSpouseQualification tbody').append(new_row);
        $('#total_quS').val(new_no);

        updateQualificationButtons();
    }

    function removeQualification() {
        if ($('#tblSpouseQualification tbody tr').length > 1) {
            $(this).closest('tr').remove();
            let lastRowId = $('#tblSpouseQualification tbody tr:last').attr('id');
            $('#total_quS').val(lastRowId.split('_')[1]);
            updateQualificationButtons();
        }
    }

    $(document).on('click', '.add-SpouseQualification', addSpouseQualification);
    $(document).on('click', '.remove-SpouseQualification', removeQualification);

    function addSpouseQualifications() {
        if ($("#formSpouseQualification").valid()) {
            let qualificationList = storeSpouseQualification();
            $.ajax({
                type: 'POST',
                url: '/api/courseMembers/SpouseQualification',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(qualificationList),
                success: function () {
                    toastr.success('Qualifications saved successfully!');
                    displayTab('SpousePartial');
                },
                error: function () {
                    toastr.error('Operation Failed!');
                }
            });
        }
    }

    $(document).ready(function () {
        $("#formSpouseQualification").validate({
            errorClass: "text-danger",
            rules: {
                quSProfessionalEdu: { required: true },
                quSAcademicAchievement: { required: true },
                quSDivision: { required: true },
                quSInstitute: { required: true }
            },
            messages: {
                quSProfessionalEdu: "Enter Professional Qualification",
                quSAcademicAchievement: "Enter Academic Achievement",
                quSDivision: "Enter Grade/Division",
                quSInstitute: "Enter Institute"
            }
        });
        updateQualificationButtons();
    });
    // #endregion
</script>


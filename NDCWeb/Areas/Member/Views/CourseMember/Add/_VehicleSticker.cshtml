@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formCMVehicleSticker" }))
{
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="card shadow p-3 mt-4">
            <div class="card-header" style="background-color:#fff">
                VEHICLE STICKER
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group col-md-2">
                        <Label class="control-label">Brand/Model No</Label>
                        <input type="text" name="Colour" id="vsBrandModelNo_1" required title="Enter Brand/Model No" class="form-control" placeholder="Brand/Model No">
                    </div>
                    <div class="form-group col-md-1">
                        <Label class="control-label">Colour</Label>
                        <input type="text" name="Colour" id="vsColour_1" required title="Enter Colour" class="form-control" placeholder="Colour">
                    </div>
                    <div class="form-group col-md-2">
                        <Label class="control-label">Registration No</Label>
                        <input type="text" name="RegistrationNo" id="vsRegistrationNo_1" required title="Enter RegistrationNo" class="form-control" placeholder="RegistrationNo">
                    </div>
                    <div class="form-group col-md-2">
                        <Label class="control-label">Driving License No</Label>
                        <input type="text" name="DrivingLicenseNo" id="vsDrivingLicenseNo_1" required title="Enter Driving License No" class="form-control" placeholder="Driving License No">
                    </div>
                    <div class="form-group col-md-2">
                        <label>Upload Image(s) Registration Certificate:</label>
                        <input id="vsRegistrationCertificatePicfile_1" type="file" name="vsRegistrationCertificatePicfile" onchange="imgValidateEdit('vsRegistrationCertificatePicfile_1', 'hdnRegistrationCertificatePath_1')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                        <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                        <input type="hidden" value="#" id="hdnRegistrationCertificatePath_1">
                    </div>
                    <div class="form-group col-md-2">
                        <label>Upload Image(s) of Driving License:</label>
                        <input id="vsDrivingLicensePicfile_1" type="file" name="vsDrivingLicensePicfile" onchange="imgValidateEdit('vsDrivingLicensePicfile_1', 'hdnDrivingLicensePath_1')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                        <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                        <input type="hidden" value="#" id="hdnDrivingLicensePath_1">
                    </div>
                    <div class="form-group col-md-1">
                        <Label class="control-label pb-1" style="width:100%"></Label>
                        <button type="button" class="add-VehicleSticker btn btn-outline-primary btn-sm"><i class="fa fa-plus"></i></button>
                        <button type="button" class="remove-VehicleSticker btn btn-outline-danger ml-2 btn-sm"><i class="fa fa-minus"></i></button>
                    </div>
                </div>
                <div id="new_vs"></div>
                <input type="hidden" value="1" id="total_vs">

            </div>
            <div class="form-group">
                <div class="text-center">
                    <input type="button" id="btnSaveVehicleSticker" value="Save" onclick="addMemberVehicleStickers()" class="btn btn-outline-danger" />
                </div>
            </div>

        </div>
    </div>
}

<script>
    // #region Vehicle Sticker
    function storeVehicleSticker() {
        let ttlcv = $('#total_vs').val();
        let vehicleStickers = [];
        for (i = 1, j = 0; i <= ttlcv; i++ , j++) {
            vehicleStickers[j] = {
                VehicleId: $('#vsVehicleId_' + i).val(),
                BrandModelNo: $('#vsBrandModelNo_' + i).val(),
                Colour: $('#vsColour_' + i).val(),
                RegistrationNo: $('#vsRegistrationNo_' + i).val(),
                DrivingLicenseNo: $('#vsDrivingLicenseNo_' + i).val(),
                NoOfVehicle: $('#vsNoOfVehicle_' + i).val(),
                RegistrationCertificatePath: $('#hdnRegistrationCertificatePath_' + i).val() || '#',
                DrivingLicensePath: $('#hdnDrivingLicensePath_' + i).val() || '#',
            };
        }
        return vehicleStickers;
    }

    $('.add-VehicleSticker').on('click', addVehicleSticker);
    $('.remove-VehicleSticker').on('click', removeVehicleSticker);
    function addVehicleSticker() {
        let new_row_no = parseInt($('#total_vs').val()) + 1;
        let new_row_inputs = `<div id="VehicleSticker_${new_row_no}" class="form-row">
                                <div class="form-group col-md-2">
                                    <input type="text" name="Brand" id="vsBrandModelNo_${new_row_no}" required title="Enter Brand/Model No" class="form-control" placeholder="Brand/Model No">
                                </div>
                                <div class="form-group col-md-1">
                                    <input type="text" name="Colour" id="vsColour_${new_row_no}" required title="Enter Colour" class="form-control" placeholder="Colour">
                                </div>
                                <div class="form-group col-md-2">
                                    <input type="text" name="RegistrationNo" id="vsRegistrationNo_${new_row_no}" required title="Enter RegistrationNo" class="form-control" placeholder="RegistrationNo">
                                </div>
                                <div class="form-group col-md-2">
                                    <input type="text" name="DrivingLicenseNo" id="vsDrivingLicenseNo_${new_row_no}" required title="Enter Driving License No" class="form-control" placeholder="Driving License No">
                                </div>
                                <div class="form-group col-md-2">
                                    <input id="vsRegistrationCertificatePicfile_${new_row_no}" type="file" name="vsRegistrationCertificatePicfile" onchange="imgValidateEdit('vsRegistrationCertificatePicfile_${new_row_no}', 'hdnRegistrationCertificatePath_${new_row_no}')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                                    <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                                    <input type="hidden" value="#" id="hdnRegistrationCertificatePath_${new_row_no}">
                                </div>
                                <div class="form-group col-md-2">
                                    <input id="vsDrivingLicensePicfile_${new_row_no}" type="file" name="vsDrivingLicensePicfile" onchange="imgValidateEdit('vsDrivingLicensePicfile_${new_row_no}', 'hdnDrivingLicensePath_${new_row_no}')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                                    <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                                    <input type="hidden" value="#" id="hdnDrivingLicensePath_${new_row_no}">
                                </div>
                            </div>`
        $('#new_vs').append(new_row_inputs);
        $('#total_vs').val(new_row_no);
    }
    function removeVehicleSticker() {
        let last_row_no = $('#total_vs').val();

        if (last_row_no > 1) {
            $('#VehicleSticker_' + last_row_no).remove();
            $('#total_vs').val(last_row_no - 1);
        }
    }
    // #endregion

    function addMemberVehicleStickers() {
        if ($("#formCMVehicleSticker").valid()) {
            let vehicleStickerList = storeVehicleSticker();
            let vehicleStickers = JSON.stringify(vehicleStickerList);
            $.ajax({
                type: 'post',
                url: '/api/courseMembers/VehicleSticker',
                data: vehicleStickers,
                contentType: "application/json; charset=utf-8",
                datatype: 'json',
                success: function (data, textStatus, xhr) {
                    toastr.info(textStatus);
                    displayTab('TallyPartial');
                },
                error: function () {
                    toastr.error('Operation Failed!');
                }
            });
        }
    }
</script>


@model NDCWeb.Areas.Member.View_Models.TallyDetailCrtVM

<div class="card mt-4">
    <div class="card-header">
        Administration
    </div>

    @using (Html.BeginForm(null, null, FormMethod.Post, new { id = "formCMTally" }))
    {
        <div class="card-body">
            @Html.AntiForgeryToken()

            @Html.ValidationSummary(true, "", new { @class = "text-danger" })
            <div class="card mt-2">
                <div class="card-header" style="background-color:#fff">
                    Name Tally
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <table class="table table-secondary">
                            <thead>
                                <tr>
                                    <th rowspan="2">Rank (in abbreviated form)</th>
                                    <th colspan="4">Name</th>
                                </tr>
                                <tr>
                                    <th>As per Passport</th>
                                    <th>As Required on Name Tab</th>
                                    <th>Nick name which you would like to be addressed</th>
                                    <th>Service/Country</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        @Html.EditorFor(model => model.RankAbbr, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.RankAbbr, "", new { @class = "text-danger" })
                                    </td>
                                    <td>
                                        @Html.EditorFor(model => model.PassportName, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.PassportName, "", new { @class = "text-danger" })
                                    </td>
                                    <td>
                                        @Html.EditorFor(model => model.TabName, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.TabName, "", new { @class = "text-danger" })
                                    </td>
                                    <td>
                                        @Html.EditorFor(model => model.NickName, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.NickName, "", new { @class = "text-danger" })
                                    </td>
                                    <td>
                                        @Html.EditorFor(model => model.CountryService, new { htmlAttributes = new { @class = "form-control" } })
                                        @Html.ValidationMessageFor(model => model.CountryService, "", new { @class = "text-danger" })
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-header" style="background-color:#fff">
                    <span class="font-weight-bold" style="color:red">Note</span>
                </div>
                <div class="card-body text-justify">
                    <p>
                        College created name tabs will be issued to all course participants. These are expected to be worn on civil clothes. Foreign Course Members, who do not wear name tabs as part of uniform, are requested to wear the samename tabs along with their uniforms also. Wearing of name tabs is mendatory for all outstation and social functions.
                    </p>

                </div>
            </div>

            <div class="card mt-2">
                <div class="card-header" style="background-color:#fff">
                    Tele Directory of Current NDC Course
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group col-md-3">
                            <Label class="control-label">Name/Rank</Label>
                            @Html.EditorFor(model => model.NameORRank, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.NameORRank, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-5">
                            <Label class="control-label">Resi Address</Label>
                            @Html.EditorFor(model => model.ResidentialAddress, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.ResidentialAddress, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-2">
                            <Label class="control-label">Mobile No</Label>
                            @Html.EditorFor(model => model.MobileNo, new { htmlAttributes = new { @class = "form-control", @type = "Numeric" } })
                            @Html.ValidationMessageFor(model => model.MobileNo, "", new { @class = "text-danger" })
                        </div>
                        <div class="form-group col-md-2">
                            <Label class="control-label">Tele No</Label>
                            @Html.EditorFor(model => model.TelephoneNo, new { htmlAttributes = new { @class = "form-control", @type = "Numeric" } })
                            @Html.ValidationMessageFor(model => model.TelephoneNo, "", new { @class = "text-danger" })
                        </div>
                    </div>
                </div>
            </div>
            <div class="card mt-2">
                <div class="card-header" style="background-color:#fff">
                    Vehicle Sticker
                </div>
                <div class="card-body">
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <Label class="control-label">Brand/Model No</Label>
                            <input type="text" name="Brand" id="vsBrandModelNo_1" class="form-control" placeholder="Brand/Model No">
                        </div>
                        <div class="form-group col-md-1">
                            <Label class="control-label">Colour</Label>
                            <input type="text" name="Colour" id="vsColour_1" class="form-control" placeholder="Colour">
                        </div>
                        <div class="form-group col-md-2">
                            <Label class="control-label">Registration No</Label>
                            <input type="text" name="RegistrationNo" id="vsRegistrationNo_1" class="form-control" placeholder="RegistrationNo">
                        </div>
                        <div class="form-group col-md-2">
                            <Label class="control-label">Driving License No</Label>
                            <input type="text" name="DrivingLicenseNo" id="vsDrivingLicenseNo_1" class="form-control" placeholder="Driving License No">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Upload Image(s) Registration Certificate:</label>
                            <input id="vsRegistrationCertificatePicfile_1" type="file" name="vsRegistrationCertificatePicfile" onchange="imgValidateEdit('vsRegistrationCertificatePicfile_1', 'hdnRegistrationCertificatePath_1')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                            <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                            <input type="hidden" value="#" id="hdnRegistrationCertificatePath_1">
                        </div>
                        <div class="form-group col-md-2">
                            <label>Upload Image(s) of Driving License:</label>
                            <input id="vsDrivingLicensePicfile_1" type="file" name="vsDrivingLicensePicfile" onchange="imgValidateEdit('vsDrivingLicensePicfile_1', 'hdnDrivingLicensePath_1')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                            <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                            <input type="hidden" value="#" id="hdnDrivingLicensePath_1">
                        </div>
                        <div class="form-group col-md-1">
                            <Label class="control-label pb-1" style="width:100%"></Label>
                            <button type="button" class="add-VehicleSticker btn btn-outline-primary btn-sm"><i class="fa fa-plus"></i></button>
                            <button type="button" class="remove-VehicleSticker btn btn-outline-danger ml-2 btn-sm"><i class="fa fa-minus"></i></button>
                        </div>
                    </div>
                    <div id="new_vs"></div>

                    <input type="hidden" value="1" id="total_vs">

                </div>
            </div>

        </div>
        <div class="card-footer text-center bg-white">
            <input type="button" id="btnSaveTally" value="Submit" onclick="addTally()" class="btn btn-primary btn-lg" />
        </div>

    }

</div>

@Scripts.Render("~/bundles/jqueryval")
<script>
    // #region Vehicle Sticker
    function storeVehicleSticker() {
        let ttlcv = $('#total_vs').val();
        let vehicleStickers = [];
        for (i = 1, j = 0; i <= ttlcv; i++, j++) {
            vehicleStickers[j] = {
                VehicleId: $('#vsVehicleId_' + i).val(),
                BrandModelNo: $('#vsBrandModelNo_' + i).val(),
                Colour: $('#vsColour_' + i).val(),
                RegistrationNo: $('#vsRegistrationNo_' + i).val(),
                DrivingLicenseNo: $('#vsDrivingLicenseNo_' + i).val(),
                NoOfVehicle: $('#vsNoOfVehicle_' + i).val(),
                RegistrationCertificatePath: $('#hdnRegistrationCertificatePath_' + i).val() || '#',
                DrivingLicensePath: $('#hdnDrivingLicensePath_' + i).val() || '#',
            };
        }
        return vehicleStickers;
    }

    $('.add-VehicleSticker').on('click', addVehicleSticker);
    $('.remove-VehicleSticker').on('click', removeVehicleSticker);
    function addVehicleSticker() {
        let new_row_no = parseInt($('#total_vs').val()) + 1;
        let new_row_inputs = `<div id="VehicleSticker_${new_row_no}" class="form-row">
                                <div class="form-group col-md-2">
                                    <input type="text" name="Brand" id="vsBrandModelNo_${new_row_no}" required title="Enter Brand/Model No" class="form-control" placeholder="Brand/Model No">
                                </div>
                                <div class="form-group col-md-1">
                                    <input type="text" name="Colour" id="vsColour_${new_row_no}" required title="Enter Colour" class="form-control" placeholder="Colour">
                                </div>
                                <div class="form-group col-md-2">
                                    <input type="text" name="RegistrationNo" id="vsRegistrationNo_${new_row_no}" required title="Enter RegistrationNo" class="form-control" placeholder="RegistrationNo">
                                </div>
                                <div class="form-group col-md-2">
                                    <input type="text" name="DrivingLicenseNo" id="vsDrivingLicenseNo_${new_row_no}" required title="Enter Driving License No" class="form-control" placeholder="Driving License No">
                                </div>
                                <div class="form-group col-md-2">
                                    <input id="vsRegistrationCertificatePicfile_${new_row_no}" type="file" name="vsRegistrationCertificatePicfile" onchange="imgValidateEdit('vsRegistrationCertificatePicfile_${new_row_no}', 'hdnRegistrationCertificatePath_${new_row_no}')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                                    <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                                    <input type="hidden" value="#" id="hdnRegistrationCertificatePath_${new_row_no}">
                                </div>
                                <div class="form-group col-md-2">
                                    <input id="vsDrivingLicensePicfile_${new_row_no}" type="file" name="vsDrivingLicensePicfile" onchange="imgValidateEdit('vsDrivingLicensePicfile_${new_row_no}', 'hdnDrivingLicensePath_${new_row_no}')" class="uploadify-button form-control-file" accept="image/jpeg,image/png" />
                                    <p class="text-info">Max size 250 KB, File Type (.jpg, .jpeg, .png)</p>
                                    <input type="hidden" value="#" id="hdnDrivingLicensePath_${new_row_no}">
                                </div>
                            </div>`
        $('#new_vs').append(new_row_inputs);
        $('#total_vs').val(new_row_no);
    }
    function removeVehicleSticker() {
        let last_row_no = $('#total_vs').val();

        if (last_row_no > 1) {
            $('#VehicleSticker_' + last_row_no).remove();
            $('#total_vs').val(last_row_no - 1);
        }
    }
    // #endregion

    function fillTallyDetail() {
        let tally = {
            RankAbbr: $("#RankAbbr").val(),
            PassportName: $("#PassportName").val(),
            TabName: $("#TabName").val(),
            NickName: $("#NickName").val(),
            CountryService: $("#CountryService").val(),
            NameORRank: $("#NameORRank").val(),
            ResidentialAddress: $("#ResidentialAddress").val(),
            MobileNo: $("#MobileNo").val(),
            TelephoneNo: $("#TelephoneNo").val(),

            //BrandModelNo: $("#BrandModelNo").val(),
            //Colour: $("#Colour").val(),
            //RegistrationNo: $("#RegistrationNo").val(),
            //DrivingLicenseNo: $("#DrivingLicenseNo").val(),
            //NoOfVehicle: $("#NoOfVehicle").val(),
            //RegistrationCertificatePath: $("#RegistrationCertificatePath").val() || '#',
            //DrivingLicensePath: $("#DrivingLicensePath").val() || '#',
        }
        return tally;
    }
    function addTally() {
        if ($("#formCMTally").valid()) {
            let tallyList = fillTallyDetail();
            let vehicleStickerList = storeVehicleSticker();

            let tallyVehicleList = {
                tally: tallyList,
                vehicleStickers: vehicleStickerList,
            }
            let tallyVehicles = JSON.stringify(tallyVehicleList);

            $.ajax({
                type: 'post',
                url: '/api/courseMembers/Tally',
                data: tallyVehicles,
                contentType: "application/json; charset=utf-8",
                datatype: 'json',
                success: function (data, textStatus, xhr) {
                    toastr.info(textStatus);
                    displayTab('TallyPartial');
                },
                error: function () {
                    toastr.error('Operation Failed!');
                }
            })
        }
    }
</script>

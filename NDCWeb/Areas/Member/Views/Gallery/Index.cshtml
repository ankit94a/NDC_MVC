@model IEnumerable<NDCWeb.View_Models.HomeBannerSliderVM>
@using NDCWeb.Infrastructure.Constants;
@{
    ViewBag.Title = "Photo Gallery";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

<style>
    /* Gallery Header */
    .gallery-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: #0d6efd;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 6px rgba(0, 0, 0, 0.2);
    }

    .gallery-subtitle {
        color: #6c757d;
        font-size: 1.1rem;
        margin-top: 8px;
        font-style: italic;
    }

    /* Image Cards */
    .gallery-card {
        position: relative;
        overflow: hidden;
        border-radius: 12px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
    }

        .gallery-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .gallery-card:hover img {
            transform: scale(1.08);
        }

        .gallery-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
        }

    /* Caption Overlay */
    .gallery-caption {
        position: absolute;
        bottom: 0;
        width: 100%;
        background: rgba(0, 0, 0, 0.55);
        color: #fff;
        padding: 10px;
        font-size: 0.9rem;
        text-align: center;
        opacity: 0;
        transition: opacity 0.4s ease;
    }

    .gallery-card:hover .gallery-caption {
        opacity: 1;
    }

    /* Modal */
    .modal-content {
        border-radius: 15px;
        overflow: hidden;
    }

    #modalImage {
        max-height: 70vh;
        object-fit: contain;
    }

    .calendar-header h4 {
        font-weight: bold;
        color: #333;
    }
</style>

<!-- Gallery Header -->
<div class="container">
    <div class="card shadow p-3">
        <div class="card-header custom-header text-center my-5 ">
            <h2 class="gallery-title text-white">Photo Gallery</h2>
            <p class="gallery-subtitle text-white">A glimpse into our moments, events, and celebrations</p>
        </div>
        <div class="card-body">
            <!-- Calendar Header -->
            <div class="border border-2 border-light rounded shadow-sm p-3 mb-4">
                <div class="calendar-header d-flex justify-content-between align-items-center">
                    <button id="prevMonth" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <h4 id="currentMonth" class="mb-0"></h4>
                    <button id="nextMonth" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>

            <!-- Gallery Container -->
            <div id="galleryContainer" class="row g-4"></div>

            <!-- Modal -->
            <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-xl">
                    <div class="modal-content bg-dark text-light">
                        <div class="modal-body text-center p-0">
                            <img id="modalImage" src="" class="img-fluid" alt="">
                        </div>
                        <div class="modal-footer justify-content-between">
                            <p id="modalCaption" class="mb-0"></p>
                            <button type="button" class="btn btn-outline-light rounded-pill px-4" data-bs-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

</div>



@section Scripts {
    <script>
        let currentDate = new Date();

        $(function () {
            loadGallery(currentDate.getFullYear(), currentDate.getMonth() + 1);

            $("#prevMonth").click(function () {
                currentDate.setMonth(currentDate.getMonth() - 1);
                loadGallery(currentDate.getFullYear(), currentDate.getMonth() + 1);
            });

            $("#nextMonth").click(function () {
                currentDate.setMonth(currentDate.getMonth() + 1);
                loadGallery(currentDate.getFullYear(), currentDate.getMonth() + 1);
            });
        });

        function loadGallery(year, month) {
            let monthName = new Date(year, month - 1).toLocaleString("default", { month: "long" });
            $("#currentMonth").text(monthName + " " + year);

            $.ajax({
                type: "POST",
                url: '@Url.Action("GetImageGalleryByMonth")',
                data: { year: year, month: month },
                dataType: "json",
                success: function (response) {
                    renderGallery(response.gallery, monthName, year);
                },
                error: function () {
                    $("#galleryContainer").html('<p class="text-center text-muted">Server Not Found</p>');
                }
            });
        }

        function renderGallery(gallery, monthName, year) {
            let $container = $("#galleryContainer");
            $container.empty();

            if (!gallery || gallery.length === 0) {
                $container.html(`<p class="text-center text-muted">No images available for ${monthName} ${year}</p>`);
                return;
            }

            $.each(gallery, function (i, mg) {
                $.each(mg.iMediaFiles, function (j, mf) {
                    let mfPath = mf.FilePath.replace("~", "");
                    $container.append(`
                        <div class="col-md-4">
                            <div class="gallery-card" data-src="${mfPath}" data-caption="${mg.Caption}">
                                <img src="${mfPath}" alt="${mg.Caption}">
                                <div class="gallery-caption">${mg.Caption}</div>
                            </div>
                        </div>
                    `);
                });
            });

            // Attach click event for popup
            $(".gallery-card").click(function () {
                let src = $(this).data("src");
                let caption = $(this).data("caption");
                $("#modalImage").attr("src", src);
                $("#modalCaption").text(caption);
                $("#imageModal").modal("show");
            });
        }
    </script>
}
